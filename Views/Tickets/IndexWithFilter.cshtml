@using System.Collections.Generic;
@using TAS360.Models.ViewModel;
@using Newtonsoft.Json;
@model List<TAS360.Models.ViewModel.TicketViewModel>
@{
    ViewBag.Title = "Tickets filtrados del TAS360"; // Establece el título de la página

    string encodedCurrentList = "";// Inicializa la variable para almacenar la lista para el URL
    //Serializa y posteriormente codifica el objeto a enviar
    var serializedObject = JsonConvert.SerializeObject(Model.FirstOrDefault().CurrentList2);
    encodedCurrentList = HttpUtility.UrlEncode(serializedObject);
}

<div class="jumbotron">
    <h1>Lista de Tickets filtrados</h1>
    <p class="lead">
        @if (@Model.Count() < 90)
        {
            <text>Se muestran @Model.Count() resultados para el filtro aplicado.</text>
        }
        else
        {
            <text>Solo se muestran los primeros 90 resultados de tu filtro , puedes agregar mas criterios de busqueda para encontrar el ticket que deseado.</text>
        }
    </p>
    <div class="row">
        @*Estos botones redirigen a otras acciones dentro del Ticket Controller*@
        <button onclick="document.location.href = '@Url.Content("~/Tickets/CreateTicket")'" type="button" class="btn btn-success" data-toggle="tooltip" title="se abrirá un formulario para crear un Ticket">
            Crear un Ticket &raquo;
        </button>
        <button onclick="document.location.href = '@Url.Content("~/Tickets/Filter_Tickets")'" type="button" class="btn btn-warning" data-toggle="tooltip" title="Realiza un filtrado personalizado de los Tickets ">
            Filtrado &fnof;
        </button>
        <button onclick="document.location.href = '@Url.Content("~/Tickets/ExportTableTickets/?encodedCurrentList=" + ViewBag.EncodedCurrentList)'" type="button" class="btn btn-info" data-toggle="tooltip" title="Exporta la tabla actual ">
            Exportar &pound;
        </button>
    </div>

</div>
<div class="row">
    <div class="col-md-12">
        <table class="table table-success table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th colspan="1" scope="col">Id</th>
                    <th colspan="1" scope="col">Titulo</th>
                    <th colspan="1" scope="col">Status</th>
                    <th colspan="2" scope="col">Usuario</th>
                    <th colspan="1">Subsistema</th>
                    <th colspan="1">Terminal</th>
                    <th colspan="1">Acciones</th>
                </tr>

            </thead>
            <tbody>
                @*Llena la tabla con las columnas id, categoría, usuario, subsistema, terminal y los botones para mostrar y editar ticket*@
                @if (Model != null)
                {
                    foreach (var Ticket in Model)
                    {
                        <tr>
                            <td colspan="1"> @Ticket.id</td>
                            <td colspan="1"> @Ticket.titulo</td>
                            <td colspan="1"> @Ticket.status_name</td>
                            <td colspan="2"> @Ticket.usuario_name</td>
                            <td colspan="1"> @Ticket.Subsistema_name</td>
                            <td colspan="1"> @Ticket.terminal_name</td>
                            <td colspan="1">
                                @if (Ticket.Status == 12)
                                {
                                    <button onclick="document.location.href = '@Url.Content("~/Tickets/ShowTicket/" + Ticket.id)'" class="btn btn-default" data-toggle="tooltip" title="Detalles el Ticket">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z" /></svg>
                                    </button>
                                }
                                else
                                {
                                    <button onclick="document.location.href = '@Url.Content("~/Tickets/ShowTicket/" + Ticket.id)'" class="btn btn-default" data-toggle="tooltip" title="Detalles el Ticket">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z" /></svg>
                                    </button>
                                    <button onclick="document.location.href = '@Url.Content("~/Tickets/EditTicket/" + Ticket.id)'" class="btn btn-primary" data-toggle="tooltip" title="Editar el Ticket">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z" /></svg>
                                    </button>
                                }

                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>


